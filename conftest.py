import pytest
import requests
import allure

class ApiClient:
    def __init__(self, base_address, token):
        self.base_address = base_address
        self.token = token

    def post(self, path="/", params=None, data=None, json=None, headers=None):
        url = f"{self.base_address}{path}"
        headers = headers or {}
        headers["Authorization"] = f"Bearer {self.token}"
        with allure.step(f'POST request to: {url}'):
            return requests.post(url=url, params=params, data=data, json=json, headers=headers)

    def get(self, path="/", params=None, headers=None):
        url = f"{self.base_address}{path}"
        headers = headers or {}
        headers["Authorization"] = f"Bearer {self.token}"
        with allure.step(f'Отправка запроса: {url}'):
            return requests.get(url=url, params=params, headers=headers)


@pytest.fixture
def marm_api():
    token = "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ7XCJhdXRoVHlwZVwiOlwiTERBUFwiLFwidWlkXCI6XCJTLTEtNS0yMS0yNTYyNDE4NjY1LTMyMTg1ODU1NTgtMTgxMzkwNjgxOC0xMDAzXCIsXCJsb2dpblwiOlwidGVzbGFcIixcInNpZFwiOlwiUy0xLTUtMjEtMjU2MjQxODY2NS0zMjE4NTg1NTU4LTE4MTM5MDY4MTgtMTAwM1wiLFwib3BlcmF0b3JJZFwiOm51bGwsXCJkaXNwbGF5TmFtZVwiOlwiVGVzbGEgTmlrb2xhXCIsXCJwZXJtaXNzaW9uc1wiOlt7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCS0LjQtNC40LzQvtGB0YLRjNCc0JDQoNCcXCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcItCf0J_QpNCUOtCe0J8t0JLQuNC00LjQvNC-0YHRgtGM0J_Qn9Ck0JRcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwiWmFrYXpDaGVrb3ZLS1RfQUM60J7Qny3Ql9Cw0LrQsNC30JDQs9GA0LXQs9Cw0YLQvtCyXCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcIlpha2F6Q2hla292S0tUX0FDOtCe0J8t0JTQvtGB0YLRg9C_0JrQl9Cw0LrQsNC30KfQtdC60L7QslwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCa0L7QvdGC0YDQvtC70YxcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0JzQkNCg0Jw60J7Qny3QmtC-0L3RgtGA0L7Qu9GM0JDQstGC0L7QvdC-0LzQvdGL0LXQotC10YDRgNC40YLQvtGA0LjQuFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCa0L7QvdGC0YDQvtC70YzQltCw0LvQvtCx0YtcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0JzQkNCg0Jw60J7Qny3QmtC-0L3RgtGA0L7Qu9GM0JjQvdGE0L7RgNC80LjRgNC-0LLQsNC90LjQtdCd0J9cIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0JzQkNCg0Jw60J7Qny3QmtC-0L3RgtGA0L7Qu9GM0J_QvtC40YHQutCk0JRcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0JzQkNCg0Jw60J7Qny3QmtC-0L3RgtGA0L7Qu9GM0J_RgNC-0LLQtdGA0LrQsNCn0LXQutC-0LJcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0JzQkNCg0Jw60J7Qny3QmtC-0L3RgtGA0L7Qu9GM0KDRi9C90LrQuFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCa0L7QvdGC0YDQvtC70YzQodGA0LXQtNCw0JrQmtCiXCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcItCc0JDQoNCcOtCe0J8t0J7RgtGH0LXRgtGLXCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcItCc0JDQoNCcOtCe0J8t0J7RgtGH0LXRgtGL0JTQsNC90L3Ri9C1XCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcItCc0JDQoNCcOtCe0J8t0J7RgtGH0LXRgtGL0JrQvtC90YLRgNC-0LvRjFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCe0YLRh9C10YLRi9Cf0YDQuNC80LXQvdC10L3QuNC1XCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcItCc0JDQoNCcOtCe0J8t0J7RgtGH0LXRgtGL0KDQtdCz0LjRgdGC0YDQsNGG0LjRj1wiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCe0YLRh9C10YLRi9Ci0J3QnlwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCe0YLRh9C10YLRi9Ct0LrQvtC90L7QvNC40LrQsFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQn9Cf0KTQlDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQlNC-0LPQvtCy0L7RgNGLXCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcItCY0J3QnzrQntCfLdCf0YDQvtGB0LzQvtGC0YDQmNC90YTQvtGA0LzQsNGG0LjQvtC90L3Ri9GF0J_QuNGB0LXQvFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQmtCw0YDRgtC-0YfQtdC60JrQmtCiXCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcItCf0J_QpNCUOtCe0J8t0J_RgNC-0YHQvNC-0YLRgNCa0JrQolwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQn9Cf0KTQlDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQmtC-0LvQuNGH0LXRgdGC0LLQvtCX0LDRgNC10LPQuNGB0YLRgNC40YDQvtCy0LDQvdC90YvRhdCa0JrQolwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQn9Cf0KTQlDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQmtC-0LvQuNGH0LXRgdGC0LLQvtCk0JRcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0J_Qn9Ck0JQ60J7Qny3Qn9GA0L7RgdC80L7RgtGA0JzQvtC90LjRgtC-0YDQuNC90LNcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0JzQkNCg0Jw60J7Qny3Qn9GA0L7RgdC80L7RgtGA0J7QsdGK0LXQutGC0L7QstCd0LDQmtCw0YDRgtC1XCIsXCJhY3Rpb25zXCI6XCI1MjYwXCJ9LHtcInN1YmplY3RcIjpcItCf0J_QpNCUOtCe0J8t0J_RgNC-0YHQvNC-0YLRgNCe0YLQutCw0LfQktCf0YDQuNC10LzQtVwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQn9Cf0KTQlDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQntCk0JRcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0J_Qn9Ck0JQ60J7Qny3Qn9GA0L7RgdC80L7RgtGA0J_RgNC40LXQvNCU0YDRg9Cz0LjQtdCe0YjQuNCx0LrQuFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQn9Cf0KTQlDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQn9GA0LjQtdC80J3QtdCS0LDQu9C40LTQvdGL0LXQn9Cw0YDRi1wiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQn9Cf0KTQlDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQn9GA0LjQtdC80J3QtdGC0JTQvtCz0L7QstC-0YDQsFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQn9Cf0KTQlDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQodCy0L7QtNC90LDRj1wiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQodGC0LDRgtC40YHRgtC40LrQuFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCf0YDQvtGB0LzQvtGC0YDQodGC0LDRgtC40YHRgtC40LrQuNCd0J9cIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0J_Qn9Ck0JQ60J7Qny3Qn9GA0L7RgdC80L7RgtGA0KTQlFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifSx7XCJzdWJqZWN0XCI6XCLQmNCd0J860J7Qny3QodC-0LfQtNCw0L3QuNC10JjQvdGE0L7RgNC80LDRhtC40L7QvdC90YvRhdCf0LjRgdC10LxcIixcImFjdGlvbnNcIjpcIjUyNjBcIn0se1wic3ViamVjdFwiOlwi0JzQkNCg0Jw60J7Qny3Qn9GA0L7RgdC80L7RgtGA0JjQvdGE0L7Qs9GA0LDRhNC40LrQuFwiLFwiYWN0aW9uc1wiOlwiMDAwMFwifSx7XCJzdWJqZWN0XCI6XCLQnNCQ0KDQnDrQntCfLdCt0LrQvtC90L7QvNC40LrQsFwiLFwiYWN0aW9uc1wiOlwiNTI2MFwifV19IiwiZXhwIjoxODU5OTYzMzM4fQ.xtaVlsJycC8pRpZixAucaho7RW422u7GuC7MIywXYJUWc9RosSJU1jSINa2LYdXCMXG9oQBuc7MmJKYLWczvxw"
    return ApiClient(base_address="https://marm.nalog.gov.ru:9085/", token=token)
